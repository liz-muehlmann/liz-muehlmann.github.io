I"©R<p>Welcome to part four of my <a href="http://localhost:4000/pages/tag-forest.html/#cartography" target="_blank" rel="noopener noreferrer">cartography in R</a> series. In this post, we‚Äôll download and process the state park data before adding it to the base map created in <a href="http://localhost:4000/notes/cartography-part-two" target="_blank" rel="noopener noreferrer">part II</a>.</p>

<!--more-->

<h3 id="project-outline">project outline</h3>
<hr />

<p>I had to break the tutorial into different parts because it became unwieldy. I list the component parts below. The annotated version of the code can be found in this project‚Äôs repository in the folder called <a href="https://github.com/liz-muehlmann/nps" target="_blank" rel="noopener noreferrer">r files</a></p>

<p><a href="http://localhost:4000/notes/cartography-part-one" target="_blank" rel="noopener noreferrer">I. cartography in r part one</a></p>
<ul>
  <li>install packages</li>
  <li>download usa shapefile</li>
  <li>shift alaska and hawaii</li>
  <li>save shapefile</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-two" target="_blank" rel="noopener noreferrer">II. cartography in r part two</a></p>
<ul>
  <li>create usa base map</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">III. cartography in r part three</a></p>
<ul>
  <li>download national park data</li>
  <li>process national park data</li>
  <li>shift alaska and hawaii national parks</li>
  <li>save shapefile</li>
  <li>add national parks to map</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-four" target="_blank" rel="noopener noreferrer">IV. cartography in r part four [this post]</a></p>
<ul>
  <li>download state park data</li>
  <li>process state park data</li>
  <li>shift alaska and hawaii state parks</li>
  <li>save shapefile</li>
  <li>add state parks to map</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-five" target="_blank" rel="noopener noreferrer">V. cartography in r part five</a></p>
<ul>
  <li>add in shiny functionality</li>
  <li>add markers to visited parks</li>
  <li>save and embed map</li>
</ul>

<h3 id="1-load-libraries">1. load libraries</h3>
<hr />

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="w">    </span><span class="c1">## load libraries</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span><span class="w">        </span><span class="c1"># data manipulation &amp; map creation</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"sf"</span><span class="p">)</span><span class="w">               </span><span class="c1"># loads shapefile</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span><span class="w">          </span><span class="c1"># creates the map</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"operator.tools"</span><span class="p">)</span><span class="w">   </span><span class="c1"># not-in function</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>I am not going to explain in detail what each of these packages do because I already covered it in <a href="http://localhost:4000/notes/cartography-part-one" target="_blank" rel="noopener noreferrer">part one</a>.</p>

<h3 id="2-load-data">2. load data</h3>
<hr />

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="w">    </span><span class="c1">## load data</span><span class="w">
    </span><span class="n">usa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_sf</span><span class="p">(</span><span class="s2">"~/Documents/Github/nps/shapefiles/shifted/usa/usa.shp"</span><span class="p">)</span><span class="w">
    </span><span class="n">nps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_sf</span><span class="p">(</span><span class="s2">"~/Documents/GitHub/nps/shapefiles/shifted/nps/nps.shp"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Be sure to change <code>~/Documents/Github/nps/shapefiles/shifted/usa/usa.shp</code> and <code>~/Documents/GitHub/nps/shapefiles/shifted/nps/nps.shp</code> to reflect where you saved the shifted shapefiles.</p>

<p>If your data processing and base map creation are in the same file, you can skip these lines. When you make the Leaflet call below, you‚Äôll use the name of the variable where the shape data is stored.</p>

<h3 id="3-download-state-park-data">3. download state park data</h3>
<hr />

<p>Unlike the National Park data, the state data is harder to come by. After quite a bit of searching I found the <a href="https://www.usgs.gov/programs/gap-analysis-project/science/pad-us-data-overview" target="_blank" rel="noopener noreferrer">Protected Areas Database of the United States</a> (PAD-US) created by the United States Geological Survey. The data they collect is <em>amazing</em>. It is a ‚Äúnational inventory of U.S. terrestrial and marine protected areas.‚Äù</p>

<p>When they say <em>national inventory</em>, they mean it. It includes a detailed accounting of nearly every piece of public land ‚Äúpreserved through legal or other effective means‚Äù in the United States. For my project, it‚Äôs overkill and it will take some investigating to determine what information I want to keep and what to discard.</p>

<p>The first step is to navigate to the <a href="https://www.usgs.gov/programs/gap-analysis-project/science/pad-us-data-overview" target="_blank" rel="noopener noreferrer">PAD-US</a> website and download the data. On the PAD-US website, click <em>View Data Download</em>.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-23.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-23.jpg" alt="Image: PAD-US download" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>PAD-US download</span></figcaption>
</figure>

<p>On the next page, you can download the National PAD-US data, the data by Census region, and by state. Click on <em>National Geopackage</em>. Make sure you select the geopackage one rather than the geodatabase version. On the next page, you‚Äôll confirm you‚Äôre not a robot before the download link appears.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-24.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-24.jpg" alt="Image: National data download - PAD-US" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>National data download - PAD-US</span></figcaption>
</figure>

<p>When it downloads, unzip it somewhere on your hard drive. The zip folder contains 35 files, so I suggest you create a folder before unzipping it so they stay together.</p>

<h3 id="4-find-the-right-layer">4. find the right layer</h3>
<hr />

<p>Since the geopackage is so large, R has a difficult time opening and displaying the data. There‚Äôs a couple of ways to view the data that does not rely on R. First, is to load the geopackage layers. This doesn‚Äôt load the complete data set. Instead, it just loads the layer names to use in conjunction with the <a href="https://www.usgs.gov/programs/gap-analysis-project/pad-us-data-manual#Table1" target="_blank" rel="noopener noreferrer">documentation</a> and the <a href="https://maps.usgs.gov/padus/" target="_blank" rel="noopener noreferrer">PAD-US Viewer</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="w">    </span><span class="n">layers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_layers</span><span class="p">(</span><span class="s2">"./shapefiles/original/state parks/padus_national_gpkg/PADUS3_0Geopackage.gpkg"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>I save the layer names to a variable called <code>layers</code> so I can load them whenever I want. You don‚Äôt have to, the <code>st_layers()</code> function will return the list regardless of whether it‚Äôs saved.</p>

<p><code>st_layers()</code> returns the name of the layer, then what kind of layer it is (Multi Polygon), how many features it contains, and what coordinate system it uses.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-25.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-25.jpg" alt="Image: PAD-US Layer List" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>PAD-US Layer List</span></figcaption>
</figure>

<p>The PAD-US geopackage contains seven layers which contain different kinds of information. The type of map you want to create will determine which layer you will use. For my map I want the same information for the state parks as I have for the national parks. I want:</p>
<ul>
  <li>the state where the park is located</li>
  <li>the park name</li>
  <li>the park type</li>
  <li>and the park‚Äôs size.</li>
</ul>

<p>I have to figure out which of the seven layers listed above includes this information. You can load each layer (using the <code>st_read()</code> code below), but this method usually causes R to crash because there‚Äôs too much information for it to handle.</p>

<p>Instead, I go to the <a href="https://maps.usgs.gov/padus/" target="_blank" rel="noopener noreferrer">PAD-US Viewer</a> and search for a state park. I am going to choose the <em>Valley of Fire State Park</em> in Nevada because 1) I know it exists, 2) I have been there. You can choose any state park you‚Äôve been to, or choose one from a list of parks by state on <a href="https://en.wikipedia.org/wiki/Lists_of_state_parks_by_U.S._state" target="_blank" rel="noopener noreferrer">Wikipedia</a>.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-26.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-26.jpg" alt="Image: PAD-US Viewer" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>PAD-US Viewer</span></figcaption>
</figure>

<p>In the search bar on the left, type in <em>Valley of Fire</em> (1) and select it from under the <em>Official Place Names</em> (2) panel that appears after you start typing. The map will adjust to show the park and you can click <em>Done</em> (3).</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-27.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-27.jpg" alt="Image: Search for Valley of Fire State Park" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Search for Valley of Fire State Park</span></figcaption>
</figure>

<p>The default view on the PAD-US Viewer includes the first layer‚Äôs information, <em>Fee Managers</em> in the viewer and <em>PADUS3_0Fee</em> in the geopackage. According to the documentation, most public land is ‚Äúowned in fee‚Äù though some land is held in ‚Äúlong-term easements, leases, agreements‚Äù or by Congressional designation. To own land ‚Äúin fee‚Äù means to own it completely, without limitations or conditions. The Fee layer lists what agency owns the land in its entirety.</p>

<p>I don‚Äôt actually care whether it‚Äôs in fee or easement (allowed to use someone else‚Äôs land), my interest is solely in whether the Park‚Äôs polygon is visible when this layer is selected in the viewer.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-28.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-28.jpg" alt="Image: Valley of Fire State Park Polygon" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Valley of Fire State Park Polygon</span></figcaption>
</figure>

<p>The purple-ish polygon on the map shows the geographic boundaries of the Valley of Fire State Park. This is what I want to see. Not all of the layers include the shape data for the state parks.</p>

<p>For example, if I uncheck the <em>Fee Manager</em> layer and select the <em>Federal Fee Managers (Authoritative Data)</em> layer the polygon for the <em>Valley of Fire</em> disappears. This is because it is not federal land - it‚Äôs state land. Be careful when choosing the layers because not all of them contain the correct information.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-29.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-29.jpg" alt="Image: Federal Fee Managers Layer" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Federal Fee Managers Layer</span></figcaption>
</figure>

<h3 id="5-find-the-right-data">5. find the right data</h3>
<hr />

<p>The USGS is interested in fundamentally different information than I am. Finding the right information for my map is going to take some data manipulation. Since the USGS is interested in the more technical aspects of land management, their categories are more detailed than what I need.</p>

<p>Using the PAD-US Viewer, I can investigate what information is available without having to load the entire data set into R‚Äôs viewer.</p>

<p>For this section, I am going to use the <em>Valley of Fire State Park</em> in Nevada, <em>Crissey Field State Recreation Site</em> in Oregon, and the <em>Salton Sea State Recreation Area</em> in California to make sure that I am getting the data I want from the Fee layer. I chose these parks because I have been to them. I know where they are and that they are all (mostly) state land.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps_30.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps_30.jpg" alt="Image: Valley of Fire (left), Crissey Field (center), Salton Sea (right)" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Valley of Fire (left), Crissey Field (center), Salton Sea (right)</span></figcaption>
</figure>

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i>
<i>Note:</i>
Clicking on an image will open it in a new tab.
</div>

<p>First, I need a good way to filter out national, tribal, or military land. On the <a href="https://maps.usgs.gov/padus/" target="_blank" rel="noopener noreferrer">PAD-US Viewer</a> I will look at the <em>Valley of Fire State Park</em> information. When you search for it (described above) a marker will pop up. If you click on the marker a table will show on the map that includes all the information available on that layer.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-30.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-30.jpg" alt="Image: Valley of Fire State Park Table" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Valley of Fire State Park Table</span></figcaption>
</figure>

<p>In the image the values on the left are the variable names - I‚Äôll use these later to select certain variables. On the right is the value for the specific park. I‚Äôve boxed a few of the properties which I‚Äôll check across the different parks to make sure I can get all the information I need.</p>

<ol>
  <li><em>Own_Type</em> designates who owns the land. For <em>Valley of Fire</em> it‚Äôs state owned land.</li>
  <li><em>Mang_Type</em> is the name of the agency that manages the land.</li>
  <li><em>Mang_Name</em> is the type of agency that owns the land, here state.</li>
  <li><em>Des_Tp</em> is the designation type.</li>
  <li><em>Unit_Nm</em> is the land‚Äôs name.</li>
</ol>

<p>When we look at Crissey Field, many of these fields have different values.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-31.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-31.jpg" alt="Image: Crissey Field State Recreation Site Table" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Crissey Field State Recreation Site Table</span></figcaption>
</figure>

<p>The ownership type (<em>Own_Type</em>) is the same for both: State. The <em>Mang_Type</em>, <em>Mang_Name</em>, <em>Des_Tp</em>, and (obviously) <em>Unit_Nm</em> are different.</p>

<p>Next, we need to check the Salton Sea. The Salton Sea demonstrates the problem with finding appropriate data. Since the Salton Sea is toxic, it‚Äôs owned in part by the State of California, the Bureau of Land Management, and the Bureau of Reclamation - each represented by a different color on the map.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-32.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-32.jpg" alt="Image: Salton Sea" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Salton Sea</span></figcaption>
</figure>

<p>Having visited the park, I can tell you there‚Äôs no fences or markers designating the different owners. On paper the Salton Sea may have many different owners, in real life you wouldn‚Äôt know it just by visiting the area.</p>

<p>On the left hand side of the viewer there‚Äôs a color-coded key that indicates the different Fee managers. It‚Äôs not very user-friendly because the the colors are very similar.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-33.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-33.jpg" alt="Image: Salton Sea" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Salton Sea</span></figcaption>
</figure>

<p>I don‚Äôt actually care who the fee manager of the Salton Sea is. What I am looking for, though, is whether any part of the Salton Sea includes <em>Own_Type</em> as State. If it does, I can use this column to separate the state data from any other kind.</p>

<p>In the viewer, I‚Äôll look for the blueish violet color (boxed in red above).</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-34.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-34.jpg" alt="Image: Salton Sea State Recreation Area Table" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Salton Sea State Recreation Area Table</span></figcaption>
</figure>

<p>After some trial and error I found a location about a quarter of the way down the lake‚Äôs right hand side. I am fairly certain I‚Äôve actually been to that exact location. When looking at the table, I can see that the <em>Own_Type</em> matches the Valley of Fire and Crissey Fields which means I can select the state data using this property.</p>

<p>Now we‚Äôll move back to R to load the data layer, filter for the 50 states, and for state owned land.</p>

<h3 id="6-pre-process-data-in-r">6. pre-process data in R</h3>
<hr />

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i> <i>Note:</i> I will give the entire codeblock first. I also include the individual line before describing what it does. I find this to be cleaner than including a bunch of comments in the code itself. If you want to copy and paste the code to your own file, you only need to copy the code block and not each individual line.</div>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="w">    </span><span class="n">state_parks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="s2">"./shapefiles/original/state_parks_padus/PADUS3_0Geopackage.gpkg"</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PADUS3_0Fee"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">State_Nm</span><span class="w"> </span><span class="o">%!in%</span><span class="w"> </span><span class="n">territories</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">Own_Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>
:ET