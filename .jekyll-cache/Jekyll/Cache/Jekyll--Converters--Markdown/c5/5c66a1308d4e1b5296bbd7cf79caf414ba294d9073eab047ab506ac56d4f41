I"<p>Welcome to part four of my <a href="http://localhost:4000/pages/tag-forest.html/#cartography" target="_blank" rel="noopener noreferrer">cartography in R</a> series. In this post, we’ll download and process the state park data before adding it to the base map created in <a href="http://localhost:4000/notes/cartography-part-two" target="_blank" rel="noopener noreferrer">part II</a>.</p>

<!--more-->

<h3 id="project-outline">project outline</h3>
<hr />

<p>I had to break the tutorial into different parts because it became unwieldy. I list the component parts below. The annotated version of the code can be found in this project’s repository in the folder called <a href="https://github.com/liz-muehlmann/nps" target="_blank" rel="noopener noreferrer">r files</a></p>

<p><a href="http://localhost:4000/notes/cartography-part-one" target="_blank" rel="noopener noreferrer">I. cartography in r part one</a></p>
<ul>
  <li>install packages</li>
  <li>download usa shapefile</li>
  <li>shift alaska and hawaii</li>
  <li>save shapefile</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-two" target="_blank" rel="noopener noreferrer">II. cartography in r part two</a></p>
<ul>
  <li>create usa base map</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">III. cartography in r part three</a></p>
<ul>
  <li>download national park data</li>
  <li>process national park data</li>
  <li>shift alaska and hawaii national parks</li>
  <li>save shapefile</li>
  <li>add national parks to map</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-four" target="_blank" rel="noopener noreferrer">IV. cartography in r part four </a></p>
<ul>
  <li>download state park data</li>
  <li>process state park data</li>
  <li>shift alaska and hawaii state parks</li>
  <li>separate state park data</li>
  <li>save state park data</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-five" target="_blank" rel="noopener noreferrer">V. cartography in r part five</a></p>
<ul>
  <li>add in shiny functionality</li>
  <li>add markers to visited parks</li>
  <li>save and embed map</li>
</ul>

<p><a href="http://localhost:4000/notes/cartography-part-six" target="_blank" rel="noopener noreferrer">VI. cartography in r part six</a></p>
<ul>
  <li>create individual state maps</li>
  <li>add in shiny functionality</li>
  <li>add markers to visited parks</li>
  <li>save and embed maps</li>
</ul>

<h3 id="1-load-libraries">1. load libraries</h3>
<hr />

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="w">    </span><span class="c1">## load libraries</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"tidyverse"</span><span class="p">)</span><span class="w">        </span><span class="c1"># data manipulation &amp; map creation</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"sf"</span><span class="p">)</span><span class="w">               </span><span class="c1"># loads shapefile</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span><span class="w">          </span><span class="c1"># creates the map</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="s2">"operator.tools"</span><span class="p">)</span><span class="w">   </span><span class="c1"># not-in function</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>I am not going to explain in detail what each of these packages do because I already covered it in <a href="http://localhost:4000/notes/cartography-part-one" target="_blank" rel="noopener noreferrer">part one</a>.</p>

<h3 id="2-load-data">2. load data</h3>
<hr />

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="w">    </span><span class="c1">## load data</span><span class="w">
    </span><span class="n">usa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_sf</span><span class="p">(</span><span class="s2">"~/Documents/Github/nps/shapefiles/shifted/usa/usa.shp"</span><span class="p">)</span><span class="w">
    </span><span class="n">nps</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_sf</span><span class="p">(</span><span class="s2">"~/Documents/GitHub/nps/shapefiles/shifted/nps/nps.shp"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Be sure to change <code>~/Documents/Github/nps/shapefiles/shifted/usa/usa.shp</code> and <code>~/Documents/GitHub/nps/shapefiles/shifted/nps/nps.shp</code> to reflect where you saved the shifted shapefiles.</p>

<p>If your data processing and base map creation are in the same file, you can skip these lines. When you make the Leaflet call below, you’ll use the name of the variable where the shape data is stored.</p>

<h3 id="3-download-state-park-data">3. download state park data</h3>
<hr />

<p>Unlike the National Park data, the state data is harder to come by. After quite a bit of searching I found the <a href="https://www.usgs.gov/programs/gap-analysis-project/science/pad-us-data-overview" target="_blank" rel="noopener noreferrer">Protected Areas Database of the United States</a> (PAD-US) created by the United States Geological Survey. The data they collect is <em>amazing</em>. It is a “national inventory of U.S. terrestrial and marine protected areas.”</p>

<p>When they say <em>national inventory</em>, they mean it. It includes a detailed accounting of nearly every piece of public land “preserved through legal or other effective means” in the United States. For my project, it’s overkill and it will take some investigating to determine what information I want to keep and what to discard.</p>

<p>The first step is to navigate to the <a href="https://www.usgs.gov/programs/gap-analysis-project/science/pad-us-data-overview" target="_blank" rel="noopener noreferrer">PAD-US</a> website and download the data. On the PAD-US website, click <em>View Data Download</em>.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-23.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-23.jpg" alt="Image: PAD-US download" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>PAD-US download</span></figcaption>
</figure>

<p>On the next page, you can download the National PAD-US data, the data by Census region, and by state. Click on <em>National Geopackage</em>. Make sure you select the geopackage one rather than the geodatabase version. On the next page, you’ll confirm you’re not a robot before the download link appears.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-24.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-24.jpg" alt="Image: National data download - PAD-US" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>National data download - PAD-US</span></figcaption>
</figure>

<p>When it downloads, unzip it somewhere on your hard drive. The zip folder contains 35 files, so I suggest you create a folder before unzipping it so they stay together.</p>

<h3 id="4-find-the-right-layer">4. find the right layer</h3>
<hr />

<p>Since the geopackage is so large, R has a difficult time opening and displaying the data. There’s a couple of ways to view the data that does not rely on R. First, is to load the geopackage layers. This doesn’t load the complete data set. Instead, it just loads the layer names to use in conjunction with the <a href="https://www.usgs.gov/programs/gap-analysis-project/pad-us-data-manual#Table1" target="_blank" rel="noopener noreferrer">documentation</a> and the <a href="https://maps.usgs.gov/padus/" target="_blank" rel="noopener noreferrer">PAD-US Viewer</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="w">    </span><span class="n">layers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_layers</span><span class="p">(</span><span class="s2">"./shapefiles/original/state parks/padus_national_gpkg/PADUS3_0Geopackage.gpkg"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>I save the layer names to a variable called <code>layers</code> so I can load them whenever I want. You don’t have to, the <code>st_layers()</code> function will return the list regardless of whether it’s saved.</p>

<p><code>st_layers()</code> returns the name of the layer, then what kind of layer it is (Multi Polygon), how many features it contains, and what coordinate system it uses.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-25.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-25.jpg" alt="Image: PAD-US Layer List" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>PAD-US Layer List</span></figcaption>
</figure>

<p>The PAD-US geopackage contains seven layers which contain different kinds of information. The type of map you want to create will determine which layer you will use. For my map I want the same information for the state parks as I have for the national parks. I want:</p>
<ul>
  <li>the state where the park is located</li>
  <li>the park name</li>
  <li>the park type</li>
  <li>and the park’s size.</li>
</ul>

<p>I have to figure out which of the seven layers listed above includes this information. You can load each layer (using the <code>st_read()</code> code below), but this method usually causes R to crash because there’s too much information for it to handle.</p>

<p>Instead, I go to the <a href="https://maps.usgs.gov/padus/" target="_blank" rel="noopener noreferrer">PAD-US Viewer</a> and search for a state park. I am going to choose the <em>Valley of Fire State Park</em> in Nevada because 1) I know it exists, 2) I have been there. You can choose any state park you’ve been to, or choose one from a list of parks by state on <a href="https://en.wikipedia.org/wiki/Lists_of_state_parks_by_U.S._state" target="_blank" rel="noopener noreferrer">Wikipedia</a>.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-26.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-26.jpg" alt="Image: PAD-US Viewer" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>PAD-US Viewer</span></figcaption>
</figure>

<p>In the search bar on the left, type in <em>Valley of Fire</em> (1) and select it from under the <em>Official Place Names</em> (2) panel that appears after you start typing. The map will adjust to show the park and you can click <em>Done</em> (3).</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-27.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-27.jpg" alt="Image: Search for Valley of Fire State Park" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Search for Valley of Fire State Park</span></figcaption>
</figure>

<p>The default view on the PAD-US Viewer includes the first layer’s information, <em>Fee Managers</em> in the viewer and <em>PADUS3_0Fee</em> in the geopackage. According to the documentation, most public land is “owned in fee” though some land is held in “long-term easements, leases, agreements” or by Congressional designation. To own land “in fee” means to own it completely, without limitations or conditions. The Fee layer lists what agency owns the land in its entirety.</p>

<p>I don’t actually care whether it’s in fee or easement (allowed to use someone else’s land), my interest is solely in whether the Park’s polygon is visible when this layer is selected in the viewer.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-28.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-28.jpg" alt="Image: Valley of Fire State Park Polygon" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Valley of Fire State Park Polygon</span></figcaption>
</figure>

<p>The purple-ish polygon on the map shows the geographic boundaries of the Valley of Fire State Park. This is what I want to see. Not all of the layers include the shape data for the state parks.</p>

<p>For example, if I uncheck the <em>Fee Manager</em> layer and select the <em>Federal Fee Managers (Authoritative Data)</em> layer the polygon for the <em>Valley of Fire</em> disappears. This is because it is not federal land - it’s state land. Be careful when choosing the layers because not all of them contain the correct information.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-29.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-29.jpg" alt="Image: Federal Fee Managers Layer" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Federal Fee Managers Layer</span></figcaption>
</figure>

<h3 id="5-find-the-right-data">5. find the right data</h3>
<hr />

<p>The USGS is interested in fundamentally different information than I am. Finding the right information for my map is going to take some data manipulation. Since the USGS is interested in the more technical aspects of land management, their categories are more detailed than what I need.</p>

<p>Using the PAD-US Viewer, I can investigate what information is available without having to load the entire data set into R’s viewer.</p>

<p>For this section, I am going to use the <em>Valley of Fire State Park</em> in Nevada, <em>Crissey Field State Recreation Site</em> in Oregon, and the <em>Salton Sea State Recreation Area</em> in California to make sure that I am getting the data I want from the Fee layer. I chose these parks because I have been to them. I know where they are and that they are all (mostly) state land.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps_30.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps_30.jpg" alt="Image: Valley of Fire (left), Crissey Field (center), Salton Sea (right)" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Valley of Fire (left), Crissey Field (center), Salton Sea (right)</span></figcaption>
</figure>

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i>
<i>Note:</i>
Clicking on an image will open it in a new tab.
</div>

<p>First, I need a good way to filter out national, tribal, or military land. On the <a href="https://maps.usgs.gov/padus/" target="_blank" rel="noopener noreferrer">PAD-US Viewer</a> I will look at the <em>Valley of Fire State Park</em> information. When you search for it (described above) a marker will pop up. If you click on the marker a table will show on the map that includes all the information available on that layer.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-30.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-30.jpg" alt="Image: Valley of Fire State Park Table" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Valley of Fire State Park Table</span></figcaption>
</figure>

<p>In the image the values on the left are the variable names - I’ll use these later to select certain variables. On the right is the value for the specific park. I’ve boxed a few of the properties which I’ll check across the different parks to make sure I can get all the information I need.</p>

<ol>
  <li><em>Own_Type</em> designates who owns the land. For <em>Valley of Fire</em> it’s state owned land.</li>
  <li><em>Mang_Type</em> is the name of the agency that manages the land.</li>
  <li><em>Mang_Name</em> is the type of agency that owns the land, here state.</li>
  <li><em>Des_Tp</em> is the designation type.</li>
  <li><em>Unit_Nm</em> is the land’s name.</li>
</ol>

<p>When we look at Crissey Field, many of these fields have different values.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-31.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-31.jpg" alt="Image: Crissey Field State Recreation Site Table" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Crissey Field State Recreation Site Table</span></figcaption>
</figure>

<p>The ownership type (<em>Own_Type</em>) is the same for both: State. The <em>Mang_Type</em>, <em>Mang_Name</em>, <em>Des_Tp</em>, and (obviously) <em>Unit_Nm</em> are different.</p>

<p>Next, we need to check the Salton Sea. The Salton Sea demonstrates the problem with finding appropriate data. Since the Salton Sea is toxic, it’s owned in part by the State of California, the Bureau of Land Management, and the Bureau of Reclamation - each represented by a different color on the map.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-32.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-32.jpg" alt="Image: Salton Sea" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Salton Sea</span></figcaption>
</figure>

<p>Having visited the park, I can tell you there’s no fences or markers designating the different owners. On paper the Salton Sea may have many different owners, in real life you wouldn’t know it just by visiting the area.</p>

<p>On the left hand side of the viewer there’s a color-coded key that indicates the different Fee managers. It’s not very user-friendly because the the colors are very similar.</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-33.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-33.jpg" alt="Image: Salton Sea" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Salton Sea</span></figcaption>
</figure>

<p>I don’t actually care who the fee manager of the Salton Sea is. What I am looking for, though, is whether any part of the Salton Sea includes <em>Own_Type</em> as State. If it does, I can use this column to separate the state data from any other kind.</p>

<p>In the viewer, I’ll look for the blueish violet color (boxed in red above).</p>

<figure>
    
    <a href="/assets/notes-images/nps/nps-34.jpg" target="_blank" rel="noopener noreferrer">
        <img src="/assets/notes-images/nps/nps-34.jpg" alt="Image: Salton Sea State Recreation Area Table" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>Salton Sea State Recreation Area Table</span></figcaption>
</figure>

<p>After some trial and error I found a location about a quarter of the way down the lake’s right hand side. I am fairly certain I’ve actually been to that exact location. When looking at the table, I can see that the <em>Own_Type</em> matches the Valley of Fire and Crissey Fields which means I can select the state data using this property.</p>

<p>Now we’ll move back to R to load the data layer, filter for the 50 states, and for state owned land.</p>

<h3 id="6-process-state-park-data">6. process state park data</h3>
<hr />

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i> <i>Note:</i> I will give the entire codeblock first. I also include the individual line before describing what it does. I find this to be cleaner than including a bunch of comments in the code itself. If you want to copy and paste the code to your own file, you only need to copy the code block and not each individual line.</div>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="code"><pre><span class="w">    </span><span class="c1">## create territories list</span><span class="w">
    </span><span class="n">territories</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"AS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"GU"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MP"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PR"</span><span class="p">,</span><span class="w"> </span><span class="s2">"VI"</span><span class="p">)</span><span class="w">

    </span><span class="n">state_parks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="s2">"./shapefiles/original/state_parks_padus/PADUS3_0Geopackage.gpkg"</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PADUS3_0Fee"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">State_Nm</span><span class="w"> </span><span class="o">%!in%</span><span class="w"> </span><span class="n">territories</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> 
           </span><span class="n">Own_Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"STAT"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"ACC"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"HCA"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"REC"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SCA"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SHCA"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SP"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SREC"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SRMA"</span><span class="w"> </span><span class="o">|</span><span class="w">
           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SW"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">d_Pub_Acce</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Closed"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> 
           </span><span class="n">d_Pub_Acce</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">filter</span><span class="p">(</span><span class="n">Loc_Ds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"ACC"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
           </span><span class="n">Loc_Ds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Hunter Access"</span><span class="p">,</span><span class="w">
           </span><span class="n">Loc_Ds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Public Boat Ramp"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">select</span><span class="p">(</span><span class="n">d_Own_Type</span><span class="p">,</span><span class="w"> </span><span class="n">d_Des_Tp</span><span class="p">,</span><span class="w"> </span><span class="n">Loc_Ds</span><span class="p">,</span><span class="w"> </span><span class="n">Unit_Nm</span><span class="p">,</span><span class="w"> </span><span class="n">State_Nm</span><span class="p">,</span><span class="w"> </span><span class="n">d_State_Nm</span><span class="p">,</span><span class="w"> </span><span class="n">GIS_Acres</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Access Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Trail"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Historic or Cultural Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Historical Park, Site, Monument, or Memorial"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Historic or Cultural Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Historical Park, Site, Monument, or Memorial"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Recreation Management Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Resource Management Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Wilderness"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Recreation Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Conservation Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
                            </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Park or Parkway"</span><span class="p">))</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">mutate</span><span class="p">(</span><span class="n">visited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Valley of Fire State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
                               </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Crissey Field State Recreation Site"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
                               </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Salton Sea"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
                               </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Anza-Borrego Desert State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
                               </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Jedediah Smith Redwoods State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
                               </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Del Norte Coast Redwoods State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
                               </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"not visited"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">shift_geometry</span><span class="p">(</span><span class="n">preserve_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
                    </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"below"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">sf</span><span class="o">::</span><span class="n">st_transform</span><span class="p">(</span><span class="s2">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="p">)</span><span class="w">

    </span><span class="c1">## save shifted park data</span><span class="w">
    </span><span class="c1"># st_write(state_parks, "./shapefiles/shifted/states/state_parks.shp")</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>These lines should be familiar by now, so I will briefly cover them here. For a detailed description of each line, check out <a href="http://localhost:4000/notes/cartography-part-one" target="_blank" rel="noopener noreferrer">part III</a> of this series.</p>

<ul>
  <li>line 2</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">2</span><span class="w">    </span><span class="n">territories</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"AS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"GU"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MP"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PR"</span><span class="p">,</span><span class="w"> </span><span class="s2">"VI"</span><span class="p">)</span></code></pre></figure>

<p>Line 2 creates the list of US territories that I filter out in line 5.</p>

<p>If you want to read more about this line visit <a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">part III</a> of the series.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>line 4</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">4</span><span class="w">    </span><span class="n">state_parks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">st_read</span><span class="p">(</span><span class="s2">"./shapefiles/original/state_parks_padus/PADUS3_0Geopackage.gpkg"</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PADUS3_0Fee"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span></code></pre></figure>

<p>Since we’re working with a geopackage (instead of a shapefile) we have to load the data using <code>st_read()</code> instead of <code>read_sf()</code></p>

<p><code>st_read()</code> takes two arguments. The first is the path to the geopackage. When we downloaded the PAD-US data and unzipped it, the folder contained 35 files. From those 35 make sure you choose the one with the <code>.gpkg</code> extension.</p>

<p>The second argument <code>layer =</code> specifies which layer R should load. Here, I am selecting the layer <em>PADUS3_0Fee</em> layer because I know it contains the shape data from the state parks.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>lines 5-6</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">5</span><span class="w">    </span><span class="n">filter</span><span class="p">(</span><span class="n">State_Nm</span><span class="w"> </span><span class="o">%!in%</span><span class="w"> </span><span class="n">territories</span><span class="w">  </span><span class="o">&amp;</span><span class="w">
</span><span class="m">6</span><span class="w">           </span><span class="n">Own_Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"STAT"</span><span class="p">)</span></code></pre></figure>

<p>R and the Tidyverse’s <code>filter()</code> function allows you to combine conditions within one filter call by using or <code>|</code> or and <code>&amp;</code>.</p>

<p>The logic in this line says filter the data for rows where the <em>State_Nm</em> is not in the <em>territories</em> list (discard all but the 50 states) <strong>and</strong> the <em>Own_Type</em> is <em>STAT</em>. For the row to be selected, <strong>both</strong> conditions must evaluate to true.</p>

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i>
<i>Note:</i>
The data lists state ownership as <i>STAT</i>. I found this out the hard way by running the filter with "State" and it returning no data. You can check the different values in a single column by running <code>levels(as.factor(state_parks$Own_Type))</code>
</div>

<p>The unfiltered data set had 247,507 rows. After these the two conditions in this line the data set has 53,139 rows. That’s a significant reduction but still a substantial number of rows.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>lines 7-15</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">7</span><span class="w">    </span><span class="n">filter</span><span class="p">(</span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"ACC"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">8</span><span class="w">           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"HCA"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">9</span><span class="w">           </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"REC"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">10</span><span class="w">          </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SCA"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">11</span><span class="w">          </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SHCA"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">12</span><span class="w">          </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SP"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">13</span><span class="w">          </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SREC"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">14</span><span class="w">          </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SRMA"</span><span class="w"> </span><span class="o">|</span><span class="w">
</span><span class="m">15</span><span class="w">          </span><span class="n">Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"SW"</span><span class="p">)</span><span class="w">  </span></code></pre></figure>

<p>Theoretically, lines 7-15 can be included with the first <code>filter()</code> call in line 5, but I couldn’t get it to work.</p>

<p>Next, I want to choose certain types of state owned land. For that, I am going to look at the <em>Des_Tp</em> column. According to the PAD-US documentation, the <em>Des_Tp</em> column holds information about the Designation Type. It contains 37 different land designations.</p>

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i>
<i>Note:</i>
You can view the land designation types by referencing the <a href="https://www.usgs.gov/programs/gap-analysis-project/pad-us-data-manual">PAD-US</a> documentation.
</div>

<p>I am going to restrict my data to include the following designations:</p>
<ul>
  <li>ACC (Access Areas) - after much searching this includes Hunter Access areas, Boat Ramps, and Trails. I’m most interested in the Trails.</li>
  <li>HCA (Historic or Cultural Area)</li>
  <li>REC (Recreation Management Area)</li>
  <li>SCA (State Conservation Area)</li>
  <li>SHCA (State Historical or Cultural Area)</li>
  <li>SP (State Park)</li>
  <li>SREC (State Recreation Area)</li>
  <li>SRMA (State Recreation Management Area)</li>
  <li>SW (State Wilderness)</li>
</ul>

<p>This will leave me with 50,102 rows.</p>

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i>
<i>Note:</i> 
I use the number of rows as a simple gut-check that the code is doing what I want it to. You can get the number of rows by running <code>nrow(state_parks)</code>
</div>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>Lines 16-17</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">16</span><span class="w">    </span><span class="n">filter</span><span class="p">(</span><span class="n">d_Pub_Acce</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Closed"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> 
</span><span class="m">17</span><span class="w">           </span><span class="n">d_Pub_Acce</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span></code></pre></figure>

<p>Yet another <code>filter()</code> call. These two lines tell R to exclude any row whose <em>d_Pub_Acce</em> is <strong>not</strong> <em>Closed</em> or <em>Unknown</em></p>

<p>The data has four types of access: Closed, Unknown, Open Access, and Restricted Access. I’m only interested in land that I can visit, so I want to keep only the parks with Open or Restricted Access. In the <code>filter()</code> call, I chose to use <code>!=</code> solely because months or years from now when I look at this code it will be easier for me to figure out what I was doing. I know myself and if I saw <code>d_Pub_Acce == "Open Access"</code> my first thought would be: “What are the other types?” and then I’ll try and find out and waste a bunch of time.</p>

<p>This last filter brings the total number of state parks down to 49,719. I don’t think I can reduce that number more without removing places that should be kept.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<p>*lines 18-20</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">18</span><span class="w">    </span><span class="n">filter</span><span class="p">(</span><span class="n">Loc_Ds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"ACC"</span><span class="w"> </span><span class="o">&amp;</span><span class="w">
</span><span class="m">19</span><span class="w">           </span><span class="n">Loc_Ds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Hunter Access"</span><span class="p">,</span><span class="w">
</span><span class="m">20</span><span class="w">           </span><span class="n">Loc_Ds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Public Boat Ramp"</span><span class="p">)</span></code></pre></figure>

<p>Lines 18-20 have the same logic as lines 16-17 except here I want to filter out the Hunter Access areas and Boat Ramps.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>Line 21</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">21</span><span class="w">      </span><span class="n">select</span><span class="p">(</span><span class="n">d_Own_Type</span><span class="p">,</span><span class="w"> </span><span class="n">d_Des_Tp</span><span class="p">,</span><span class="w"> </span><span class="n">Loc_Ds</span><span class="p">,</span><span class="w"> </span><span class="n">Unit_Nm</span><span class="p">,</span><span class="w"> </span><span class="n">State_Nm</span><span class="p">,</span><span class="w"> </span><span class="n">d_State_Nm</span><span class="p">,</span><span class="w"> </span><span class="n">GIS_Acres</span><span class="p">,</span><span class="w"> </span><span class="n">SHAPE</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span></code></pre></figure>

<p>Now that I’ve pared down the data a little bit, I want discard any column don’t need.</p>

<p><code>select()</code> lets me choose the columns I want to keep by name, rather than by index number.</p>

<p>I decided to keep:</p>
<ul>
  <li>d_Own_Type (owner type)</li>
  <li>d_Des_Tp (designation type - state park, resource area, etc)</li>
  <li>Loc_Ds (location description - I like this because it tells me where ponds are)</li>
  <li>Unit_Nm (park name)</li>
  <li>State_Nm (two character state abbreviation)</li>
  <li>d_State_Nm (long state name)</li>
  <li>GIS_Acres (park size)</li>
  <li>SHAPE (geometry column)</li>
</ul>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>lines 22-30</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">22</span><span class="w">  </span><span class="n">mutate</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Access Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Trail"</span><span class="p">,</span><span class="w">
</span><span class="m">23</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Historic or Cultural Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Historical Park, Site, Monument, or Memorial"</span><span class="p">,</span><span class="w">
</span><span class="m">24</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Historic or Cultural Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Historical Park, Site, Monument, or Memorial"</span><span class="p">,</span><span class="w">
</span><span class="m">25</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Recreation Management Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
</span><span class="m">26</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Resource Management Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
</span><span class="m">27</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Wilderness"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
</span><span class="m">28</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Recreation Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
</span><span class="m">29</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Conservation Area"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Preserve, Reserve, or Recreation Area"</span><span class="p">,</span><span class="w">
</span><span class="m">30</span><span class="w">                          </span><span class="n">d_Des_Tp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"State Park or Parkway"</span><span class="p">))</span></code></pre></figure>

<p><code>mutate()</code> is part of the tidyverse package and it’s extremely versatile. It is mainly used to create new variables or modify existing ones.</p>

<p>I wanted the state park designations to match closely with the types I used in the National Park data.</p>

<p>I went over the logic of using <code>mutate()</code> and <code>case_when()</code> in <a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">Part III</a> of this series, so I won’t cover it again here.</p>

<p>In its general form, the format is <code>case_when(COLUMN_NAME == "original_value" ~ "new_value")</code>. I only needed to change the values for <code>"Recreation Management Area</code>s, the rest I just populated the new column with the old values.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>lines 31-37</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">31</span><span class="w">  </span><span class="n">mutate</span><span class="p">(</span><span class="n">visited</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">case_when</span><span class="p">(</span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Valley of Fire State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
</span><span class="m">32</span><span class="w">                             </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Crissey Field State Recreation Site"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
</span><span class="m">33</span><span class="w">                             </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Salton Sea"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
</span><span class="m">34</span><span class="w">                             </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Anza-Borrego Desert State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
</span><span class="m">35</span><span class="w">                             </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Jedediah Smith Redwoods State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
</span><span class="m">36</span><span class="w">                             </span><span class="n">Unit_Nm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Del Norte Coast Redwoods State Park"</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"visited"</span><span class="p">,</span><span class="w">
</span><span class="m">37</span><span class="w">                             </span><span class="kc">TRUE</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s2">"not visited"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span></code></pre></figure>

<p>Here is where I ran into some issues. In <a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">part III</a> of the series when I processed the National Park data I included a <code>mutate()</code> and <code>case_when()</code> call to mark whether I’ve visited the park or not. It’s not a very elegant solution since I have to modify each park individually, but it was passable since I’ve only been to a handful of National Parks. For the state parks, though, it is unwieldy.</p>

<p>I had original wanted to drop the geometry and download the parks as a CSV, but even that was overwhelming.</p>

<div class="boxed">
<i class="fa-regular fa-note-sticky fa-xl"></i> <i>Note:</i> The code to drop the geometry and save some of the park data as csv can be found in the r files on <a href="https://github.com/liz-muehlmann/nps">this project's repo</a></div>

<p>In the end, I decided to focus on the parks that I <em>know</em> I’ve visited <strong>and</strong> have taken photos at. I’ve visited many, many state parks, but until I have the photos to add to the markers (<a href="http://localhost:4000/notes/cartography-part-five" target="_blank" rel="noopener noreferrer">covered in part five</a>), I’m omitting them from this code. Hopefully in the mean time I’ll figure out a better way to keep track of the parks I’ve been to.</p>

<p>The logic is the same as the National Park data. <code>mutate()</code> created a new column <code>type</code> and populated it by using <code>case_when()</code>.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>lines 38-43</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">38</span><span class="w">   </span><span class="n">shift_geometry</span><span class="p">(</span><span class="n">preserve_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
</span><span class="m">39</span><span class="w">                  </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"below"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
</span><span class="m">40</span><span class="w">   </span><span class="n">sf</span><span class="o">::</span><span class="n">st_transform</span><span class="p">(</span><span class="s2">"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span><span class="p">)</span><span class="w">
</span><span class="m">41</span><span class="w">
</span><span class="m">42</span><span class="w">   </span><span class="c1">## save shifted park data</span><span class="w">
</span><span class="m">43</span><span class="w">   </span><span class="c1"># st_write(state_parks, "./shapefiles/shifted/states/state_parks.shp")</span></code></pre></figure>

<p>I’ve covered these lines extensively in <a href="http://localhost:4000/notes/cartography-part-two" target="_blank" rel="noopener noreferrer">part II</a> and <a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">part III</a> of this series.</p>

<p>Lines 38-39 shift the state park data from Alaska and Hawaii so it appears under the continental US and of comparable size.</p>

<p>Line 40 is required to change the coordinate system from Albers to WGS84 - the latter of which is required by Leaflet.</p>

<p>Line 43 saves the shifted shapefile to the hard drive. Delete the <code>#</code> from the start of the line to save the file.</p>

<h3 id="7-divide-by-state">7. divide by state</h3>
<hr />

<div class="boxed">


<figure>
    
    <a href="https://media.tenor.com/SG1JSragv2kAAAAC/office-chaos-fire-chaotic.gif" target="_blank" rel="noopener noreferrer">
        <img src="https://media.tenor.com/SG1JSragv2kAAAAC/office-chaos-fire-chaotic.gif" alt="Image: chaos ensues" class="img-fluid mx-auto d-block" />
    </a>
    
    <figcaption><span>chaos ensues</span></figcaption>
</figure>


</div>

<p>I tried to map the base map, National Parks, and the state parks. It did not go well. R froze, my computer screamed, and chaos ensued. As a result, I had to rethink my map. I decided to separate the state parks by state, save them, and in <a href="http://localhost:4000/notes/cartography-part-six" target="_blank" rel="noopener noreferrer">part VI</a> of this never-ending series* I’ll create individual state maps. When you click on a state it’ll take you to a map that includes the state parks.</p>

<p>Unfortunately, this also means I need to separate the National Parks by state so they <em>also</em> appear on the individual maps. The logic will be the same so I am not going to update <a href="http://localhost:4000/notes/cartography-part-three" target="_blank" rel="noopener noreferrer">part III</a> to reflect that change. If you want to see that code it’s available on the <a href="https://github.com/liz-muehlmann/nps" target="_blank" rel="noopener noreferrer">project repo</a>].</p>

<p>I don’t want to manually separate and save each state, so I’m going to use a loop! I hate loops. The logic is simple enough “as long as condition X is true, do something.” So simple, yet esvery time I’ve tried to learn a programming language I have struggled with loops. That’s pretty sad considering it’s like day 2 of any programming class. Day 1 is learning how to write “Hello World!”**</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="w">    </span><span class="n">split_states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">state_parks</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_parks</span><span class="o">$</span><span class="n">State_Nm</span><span class="p">)</span><span class="w">
    </span><span class="n">all_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">split_states</span><span class="p">)</span><span class="w">   

    </span><span class="k">for</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">all_names</span><span class="p">){</span><span class="w">            
        </span><span class="n">st_write</span><span class="p">(</span><span class="n">split_states</span><span class="p">[[</span><span class="n">name</span><span class="p">]],</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"shapefiles/shifted/states/individual/"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">'.shp'</span><span class="p">))}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Look ma, new code!</p>

<ul>
  <li>line 1</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">1</span><span class="w">    </span><span class="n">split_states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">state_parks</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_parks</span><span class="o">$</span><span class="n">State_Nm</span><span class="p">)</span><span class="w"> </span></code></pre></figure>

<p>The <code>split()</code> is part of base R. It takes quite a <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/split" target="_blank" rel="noopener noreferrer">few arguments</a>, most of which are optional.</p>

<p>The first argument is the vector (or data frame) that you want to split into different groups. I want to split the <code>state_parks</code> data into its corresponding states, so it is listed first.</p>

<p>The second argument <code> f = </code> is how you want the data split. <code>f</code> in this instance stands for factor. If we run <code>levels(as.factor(state_parks$State_Nm))</code> in the terminal, it will return a list of the 50 state abbreviations. That is what we’re telling R to do here.</p>

<p>You can access an individual state using the <code>$</code> operator. <code>split_states$CA</code> will return the state park data for California.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>line 2</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">2</span><span class="w">    </span><span class="n">all_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">split_states</span><span class="p">)</span></code></pre></figure>

<p><code>names</code> is also part of base R. It does what it sounds like - it gets the names of an object. Here, I want to get the names of each split data sets.</p>

<center><i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i> <i class="fa-solid fa-paw"></i></center>

<ul>
  <li>lines 4-5</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="m">4</span><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">all_names</span><span class="p">){</span><span class="w">            
</span><span class="m">5</span><span class="w">        </span><span class="n">st_write</span><span class="p">(</span><span class="n">split_states</span><span class="p">[[</span><span class="n">name</span><span class="p">]],</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"shapefiles/shifted/states/individual/"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s1">'.shp'</span><span class="p">))}</span></code></pre></figure>

<p>Here’s the actual for loop.</p>

<p>The basic logic of a for loop is:<br />
    <code>for(x in y){ <br /> 
    do something}</code></p>

<p>Inside the parenthesis is the condition that must evaluate to TRUE if the content in the curly braces is to run.</p>

<p>In line 4, <code>for(name in all_names){</code> says as long as there’s a name in the list of all names, do whatever is inside the curly braces. <code>name</code> can be whatever you want. It’s a placeholder value. I can have it say <code>for(dogs in all_names){</code> it will still do the exact same thing. A lot of time you’ll see it as an <code>i</code> for item. I like to use more descriptive language because, again, for loops are my Achilles’ heel.</p>

<p>The <code>all_names</code> part is where ever you want R to look for the data. It will change based on your data set and variable naming conventions.</p>

<p>In line 5, I save the split data sets.</p>

<p><code>st_write()</code> is part of the <em>sf</em> package which allows us to create shapefiles. This can be any saving function (eg. write_csv() if you want to save CSVs). The function takes several arguments. In line 43 above I showed the basic structure:  st_write(data, path/to/file.shp). This is good if you only have one file, but since I’m saving them in a loop I don’t want all of the files to have the same name. R will error out after the first and tell you the file already exists.</p>

<p>The first part <code>split_states[[name]]</code> is still telling R what data to save, but using an index instead of a specific data frame name. To access an index you use <code>data[[some-value]]</code> where <code>some-value</code> is the index location. In my code, R will take the <code>split_states</code> data and go alright the first index location in <code>[[name]]</code> is 1 and return whatever value is stored in that index (here, AK). It will then do that for every index location as it loops through the <code>split_states</code> data.</p>

<p><code>paste0()</code> is also part of base R - it’s apparently faster than <code>paste()</code>. It concatenates (or links together) different pieces into one. I’m using it to create the filename. Within the <code>paste0</code> call anything within quotation marks is static. So every file will be saved to <code>"shapefiles/shifted/states/individual/"</code> and every file will have the extension <code>.shp</code>. What will change with each loop is the <code>name</code> of the file. One by one, R will loop through and save each file using the <code>name</code> it pulled from <code>all_names</code>.</p>

<p><code>st_write()</code> automatically creates the other three files that each “shapefile” needs. When the loop is done, you should have a folder of 200 files (50 states * 4 files each). Which is why I strongly recommend using <a href="https://www.dvc.org" target="_blank" rel="noopener noreferrer">DVC</a> if you’re doing any kind of version control.</p>

<h3 id="8-conclusion">8. conclusion</h3>
<hr />

<p>That’s all the processing done for the state files… <em>for now</em>. In <a href="http://localhost:4000/notes/cartography-part-six" target="_blank" rel="noopener noreferrer">part VI</a> I’ll return to the states to create each state’s own map. Next up, in <a href="http://localhost:4000/notes/cartography-part-five" target="_blank" rel="noopener noreferrer">part V</a>, I’m going back to my base map with the National Parks to add in some informational tool tips and interactivity.</p>

<hr />

<p>* I have annoyed myself with how long this series is. Hopefully it is helpful. Drop me an email or a tweet if it is.<br />
** <code>print("Hello World!")</code></p>
:ET